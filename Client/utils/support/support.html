document.addEventListener('DOMContentLoaded', () => {
    // HTML do modal
    const modalHTML = `
        <div id="supportModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <form id="supportForm">
                    <h2>Envie seu Feedback</h2>
                    <label for="name">Nome:</label>
                    <input type="text" id="name" name="name" required>
                    
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                    
                    <label for="message">Mensagem:</label>
                    <textarea id="message" name="message" rows="4" required></textarea>
                    
                    <button type="submit">Enviar</button>
                </form>
            </div>
        </div>
        <style>
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.5);
            }
            .modal-content {
                background-color: #fefefe;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
                max-width: 500px;
                color: #000;
            }
            .close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }
            form {
                display: flex;
                flex-direction: column;
            }
            label {
                margin-top: 10px;
            }
            input, textarea {
                padding: 10px;
                margin-top: 5px;
            }
            button {
                margin-top: 20px;
                padding: 10px;
                background-color: #4CAF50;
                color: white;
                border: none;
                cursor: pointer;
            }
            button:hover {
                background-color: #45a049;
            }
        </style>
    `;

    // Adiciona o HTML do modal ao final do body
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    // Seletores dos elementos do modal
    const modal = document.getElementById('supportModal');
    const btn = document.getElementById('supportButton');
    const closeBtn = document.getElementsByClassName('close')[0];
    const form = document.getElementById('supportForm');

    // Abre o modal
    btn.addEventListener('click', () => {
        modal.style.display = 'block';
    });

    // Fecha o modal quando clica no botão de fechar
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // Fecha o modal quando clica fora do modal
    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });

    // Envia o formulário e fecha o modal
    form.addEventListener('submit', (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const data = {
            name: formData.get('name'),
            email: formData.get('email'),
            message: formData.get('message')
        };

        emailjs.send('service_io4c8xa', 'template_ag8i135', data)
            .then(() => {
                alert('Mensagem enviada com sucesso!');
                form.reset();
                modal.style.display = 'none';
            })
            .catch(() => {
                alert('Falha ao enviar a mensagem, tente novamente.');
            });
    });
});

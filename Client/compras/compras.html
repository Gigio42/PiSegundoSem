<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extrair Texto de PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
</head>
<body>
    <input type="file" id="pdf-file" accept=".pdf">
    <button id="extract-btn">Extrair Texto</button>
    <div id="text-content"></div>

    <script>
        document.getElementById('extract-btn').addEventListener('click', function() {
            var file = document.getElementById('pdf-file').files[0];
            if (!file) {
                alert('Por favor, selecione um arquivo PDF.');
                return;
            }

            var reader = new FileReader();
            reader.onload = function(event) {
                var typedarray = new Uint8Array(event.target.result);
                extractText(typedarray);
            };
            reader.readAsArrayBuffer(file);
        });

        function extractText(data) {
            pdfjsLib.getDocument(data).promise.then(function(pdf) {
                var numPages = pdf.numPages;
                var textContent = '';

                var promises = [];
                for (var i = 1; i <= numPages; i++) {
                    promises.push(pdf.getPage(i).then(function(page) {
                        return page.getTextContent().then(function(pageTextContent) {
                            var pageText = '';
                            pageTextContent.items.forEach(function(textItem) {
                                pageText += textItem.str + ' ';
                            });
                            return pageText;
                        });
                    }));
                }

                Promise.all(promises).then(function(pageTexts) {
                    var fullText = pageTexts.join('\n');
                    var extractedText = extractData(fullText);
                    displayText(extractedText);
                }).catch(function(error) {
                    console.error('Erro ao extrair texto:', error);
                });
            });
        }

        function extractData(fullText) {
            var regex = /VL\s*Total\s*INCLUSÃO([\s\S]*?)Valores\s*expressos/;
            var match = regex.exec(fullText);
            if (match) {
                var data = match[1].trim();
                var dataArray = data.split(/\s+/); // Dividir dados por espaços em branco
                return {
                    cliente: dataArray[0],
                    quant_chapa: dataArray[1],
                    u_m: dataArray[2],
                    qualidade: dataArray[3],
                    gramatura: dataArray[4],
                    peso_total: dataArray[5],
                    coluna: dataArray[6],
                    valor_total: dataArray[7],
                    descrição: dataArray.slice(8).join(' ') // Unir o restante da descrição
                };
            } else {
                console.error('Texto não encontrado');
                return null;
            }
        }

        function displayText(data) {
            var textContentDiv = document.getElementById('text-content');
            textContentDiv.innerHTML = `<p>Cliente: ${data.cliente}</p>
                                        <p>Quantidade de Chapas: ${data.quant_chapa}</p>
                                        <p>Unidade de Medida: ${data.u_m}</p>
                                        <p>Qualidade: ${data.qualidade}</p>
                                        <p>Gramatura: ${data.gramatura}</p>
                                        <p>Peso Total: ${data.peso_total}</p>
                                        <p>Coluna: ${data.coluna}</p>
                                        <p>Valor Total: ${data.valor_total}</p>
                                        <p>Descrição: ${data.descrição}</p>`;
        }
    </script>
</body>
</html>

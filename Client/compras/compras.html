<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extrair Texto de PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
</head>
<body>
    <input type="file" id="pdf-file" accept=".pdf">
    <button id="extract-btn">Extrair Texto</button>
    <div id="text-content"></div>

    <script>
        document.getElementById('extract-btn').addEventListener('click', function() {
            var file = document.getElementById('pdf-file').files[0];
            if (!file) {
                alert('Por favor, selecione um arquivo PDF.');
                return;
            }

            var reader = new FileReader();
            reader.onload = function(event) {
                var typedarray = new Uint8Array(event.target.result);
                extractText(typedarray);
            };
            reader.readAsArrayBuffer(file);
        });

        function extractText(data) {
            pdfjsLib.getDocument(data).promise.then(function(pdf) {
                var numPages = pdf.numPages;
                var textContent = '';

                var promises = [];
                for (var i = 1; i <= numPages; i++) {
                    promises.push(pdf.getPage(i).then(function(page) {
                        return page.getTextContent().then(function(pageTextContent) {
                            var pageText = '';
                            pageTextContent.items.forEach(function(textItem) {
                                pageText += textItem.str + ' ';
                            });
                            return pageText;
                        });
                    }));
                }

                Promise.all(promises).then(function(pageTexts) {
                    var fullText = pageTexts.join('\n');
                    var extractedText = extractData(fullText);
                    displayText(extractedText);
                }).catch(function(error) {
                    console.error('Erro ao extrair texto:', error);
                });
            });
        }

        function extractData(fullText) {
            var regex = /VL\/Kg\s*VL\s*Total\s*(\S+)\s*([\s\S]*?)Valores\s*expressos/;
            var match = regex.exec(fullText);
            if (match) {
                var pedidoCompra = match[1];
                var data = match[2].trim();
                var dataArray = data.split(/\s+/); // Dividir dados por espaços em branco

                // Encontrar o índice do espaço após a barra na descrição
                var descricaoIndex = dataArray.findIndex(item => item.includes('/'));
                if (descricaoIndex !== -1) {
                    // Extrair a descrição até o espaço após a barra
                    var descricao = dataArray.slice(8, descricaoIndex + 1).join(' ');
                } else {
                    var descricao = dataArray.slice(8).join(' '); // Se não houver espaço após a barra, manter a descrição completa
                }

                return {
                    Pedido_de_Compra: pedidoCompra,
                    Cliente: dataArray[0],
                    Quantidade_de_Chapas: dataArray[1],
                    Unidade_de_Medida: dataArray[2],
                    Qualidade: dataArray[3],
                    Gramatura: dataArray[4],
                    Peso_Total: dataArray[5],
                    Coluna: dataArray[6],
                    Valor_Total: dataArray[7],
                    Descrição: descricao
                };
            } else {
                console.error('Texto não encontrado');
                return null;
            }
        }

        function displayText(data) {
            var textContentDiv = document.getElementById('text-content');
            textContentDiv.innerHTML = `<p>Pedido de Compra: ${data.Pedido_de_Compra}</p>
                                        <p>Cliente: ${data.Cliente}</p>
                                        <p>Quantidade de Chapas: ${data.Quantidade_de_Chapas}</p>
                                        <p>Unidade de Medida: ${data.Unidade_de_Medida}</p>
                                        <p>Qualidade: ${data.Qualidade}</p>
                                        <p>Gramatura: ${data.Gramatura}</p>
                                        <p>Peso Total: ${data.Peso_Total}</p>
                                        <p>Coluna: ${data.Coluna}</p>
                                        <p>Valor Total: ${data.Valor_Total}</p>
                                        <p>Descrição: ${data.Descrição}</p>`;
        }
    </script>
</body>
</html>
